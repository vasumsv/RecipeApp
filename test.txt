@Test
void getMettedPaymentRows_PaymentModeException() {
    // Given
    List<InvoicePayableModelForPayment> payments = Collections.singletonList(createBasePayment());

    // ONLY mock the dependency that will actually be used
    when(referentialServiceApi.getPaymentModeAndSettlementLocation(
        any(BigInteger.class),  // providerId
        any(BigInteger.class),  // entity
        any(BigInteger.class),  // feeCategory
        anyString(),            // paymentDirection
        anyString()             // currency
    )).thenThrow(new RuntimeException("Payment Mode Error"));

    // When
    List<PaymentLinesModel> result = cashAllocationDomain.getMettedPaymentRowsForManualPayment(
        payments, 
        "user1"
    );

    // Then
    assertFalse(result.isEmpty());
    assertTrue(result.get(0).getComment().contains("Payment Mode unavailable"));
}